version: "3.9"
services:
  nginx:
    image: nginx:latest
    user: '1000:1000'
    depends_on:
      - server
    volumes:
      - "./nginx.conf:/etc/nginx/nginx.conf"
    ports:
      - "7777:80"

  server: # port 8000 is server

      image: ghcr.io/thearyadev/top500-aggregator-server:latest
      #    build: .
      user: '1000:1000'
      environment:
        MYSQLDATABASE: 'railway'
        MYSQLUSER: 'root'
        MYSQLPASSWORD: 'QiyWsI7y1oGGJjz4biiu'
        MYSQLHOST: 'database'
        MYSQLPORT: '3306'
      depends_on:
        - database

  frontend:
    image: ghcr.io/thearyadev/top500-aggregator-frontend:latest
    ports:
      - "3000:3000"
    user: "1000:1000"
  # these services are internal, so secrets do not matter.
  database:
    image: mysql@sha256:566007208a3f1cc8f9df6b767665b5c9b800fc4fb5f863d17aa1df362880ed04
    user: "1000:1000"
    environment:
      MYSQL_DATABASE: 'railway'
      MYSQL_USER: 't5aggr'
      MYSQL_PASSWORD: 'QiyWsI7y1oGGJjz4biiu'
      MYSQL_ROOT_PASSWORD: 'QiyWsI7y1oGGJjz4biiu'
    volumes:
        - ./mysql-data:/var/lib/mysql
